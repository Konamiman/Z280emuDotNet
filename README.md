# Z280emuDotNet

This is a quick and dirty [.NET interop](https://learn.microsoft.com/en-us/dotnet/standard/native-interop/) wrapper
around [the z280emu project](https://github.com/mtdev79/z280emu). The goal is to be be able to unit test Z280 code using
.NET tools like [NUnit](https://nunit.org/).

This repository consists of the following projects, all contained in a Visual Studio solution:

* **z280emu_repo_submodule**: This directory contains the original z280emu repository as a [git submodule](https://git-scm.com/book/en/v2/Git-Tools-Submodules). If there's nothing there after you clone this repository, run `git submodule update --init --recursive`.
* **z280emu_dll**: Visual C++ project wrapping the original z280emu C code. It adds just one new file, `entry_points.c`, cotnaining the public entry points for the generated DLL file.
* **Z280EmuInterop**: .NET interop project. It contains the .NET classes/structs (mainly `Z280CPU`) that allow using the native DLL generated by the z280emu_dll project from within .NET code.
* **Tests**: NUnit test project that tests the behavior of the original emulator code via .NET interop code. It uses [Nestor80](https://github.com/Konamiman/Nestor80) to assemble Z280 source code.

Taking a look to the tests project is the best way to get started with the interop code.

**TODO:**

* Currently the interop layer is Windows-only, fix that.
* Extra properties in the `Z280CPU` class to access the CPU control registers (MSR et al) without having to directly access the fields in `Z280State`.
* Add support for the extra callbacks supported by the original project (initial configuration via CPU pins, interrupt vector provider, daisy chain interface, UART callbacks).
* Add more unit tests.

